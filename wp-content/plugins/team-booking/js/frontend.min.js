jQuery(document).ready(function(t){function e(e,a,i){if(e.hasClass("loading"))return false;e.toggleClass("tbk-loading");var n=e.attr("data-params");var o=e.attr("data-instance");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_change_month",month:i.attr("data-month"),year:i.attr("data-year"),params:n},function(t){e.find(".tbk-slide.tbk-active").html(t.content);e.attr("data-params",t.parameters);e.toggleClass("tbk-loading");a.getSlider().adaptHeight()},"json");return false}function a(e,a,i){if(e.hasClass("loading"))return false;e.find(".tbk-calendar-month-selector.active, .tbk-calendar-year-selector.active").trigger("click");var n=e.attr("data-params");var o=e.attr("data-instance");e.toggleClass("tbk-loading");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_show_day_schedule",day:i.attr("data-day"),slots:i.attr("data-slots"),params:n},function(t){a.showSlots(t.content);e.toggleClass("tbk-loading")},"json");return false}function i(e,a,i){if(i.hasClass("tbk-loading")){return}i.toggleClass("tbk-loading");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_checkout"},function(e){var n=a.getSlider();var o=e.content;if(i.hasClass("tbk-edit-form-action tbk-cancel")){n.replaceSlide(o)}else{n.goToSlide(n.addSlide(o).index()).adaptHeight()}if(e.action==="empty_cart"){t(".tbk-cart").addClass("tbk-cart-empty")}t(".tbk-cart").removeClass("tbk-selected").hide().find(".tbk-menu").hide();i.toggleClass("tbk-loading")},"json")}function n(e,a,i){var n=i.attr("data-type");var o=i.attr("data-item");i.toggleClass("tbk-loading");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_put_slot_into_cart",slot_id:o,remove:true},function(e){if(e.response==="removed"){t(document).find("[data-slot-id='"+o+"']").each(function(){t(this).removeClass("tbk-in-cart")});t(document).find("[data-item='"+o+"']").each(function(){var e=parseInt(t(this).closest(".tbk-cart").find(".tbk-cart-dot").text())-1;if(e<1){t(this).closest(".tbk-cart").addClass("tbk-cart-empty").hide().find(".tbk-cart-dot").text(e);t(this).closest(".tbk-menu").hide();t(this).closest(".tbk-cart").trigger("tbk:cart:empty")}else{t(this).closest(".tbk-cart").removeClass("tbk-cart-empty").show().find(".tbk-cart-dot").text(e);t(this).closest(".tbk-cart").trigger("tbk:cart:removed")}t(this).closest(".tbk-menu-item").remove()})}i.toggleClass("tbk-loading")},"json")}function o(e,a,i){var n=i.closest(".tbk-schedule-slot, .tbk-upcoming-slot");n.toggleClass("tbk-loading");var o=n.attr("data-slot");var s=n.attr("data-slot-id");var r=n.hasClass("tbk-in-cart");var l=i.closest(".calendar_main_container, .calendar_widget_container");var c=l.find(".tbk-timezones .tbk-menu .tbk-menu-item.tbk-selected").data("timezone")||false;t.post(TB_Ajax.ajax_url,{action:"tbajax_action_put_slot_into_cart",slot:o,slot_id:s,timezone:c,remove:r},function(e){if(e.response==="added"){t(document).find("[data-slot-id='"+s+"']").each(function(){t(this).addClass("tbk-in-cart")});t(document).find(".tbk-cart").each(function(){var a=parseInt(t(this).find(".tbk-cart-dot").text())+1;t(this).removeClass("tbk-cart-empty").show().find(".tbk-cart-dot").text(a);t(this).find(".tbk-menu .tbk-menu-item:last").before(e.data);t(this).trigger("tbk:cart:added")})}if(e.response==="removed"){t(document).find("[data-slot-id='"+s+"']").each(function(){t(this).removeClass("tbk-in-cart")});t(document).find(".tbk-cart").each(function(){var e=parseInt(t(this).find(".tbk-cart-dot").text())-1;if(e<1){t(this).addClass("tbk-cart-empty").hide().find(".tbk-cart-dot").text(e);t(this).trigger("tbk:cart:empty")}else{t(this).removeClass("tbk-cart-empty").show().find(".tbk-cart-dot").text(e);t(this).trigger("tbk:cart:removed")}});t(document).find("[data-item='"+s+"']").parent().remove()}n.toggleClass("tbk-loading")},"json")}function s(e,a,i){var n=i;if(e.find(".tbk-schedule-slot, .tbk-upcoming-slot").hasClass("tbk-loading")){return false}if(n.hasClass("tbk-slot-button")){n=i.closest(".tbk-schedule-slot, .tbk-upcoming-slot")}n.toggleClass("tbk-loading");var o=n.attr("data-slot");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_get_reservation_modal",slot:o},function(t){var e=a.getSlider();var o=e.addSlide(t.content);e.goToSlide(o.index()).adaptHeight();o.find("img").on("load",function(){e.adaptHeight()});n.toggleClass("tbk-loading");a.scrollToTop(i)},"json")}function r(e,a,i){if(i.hasClass("tbk-loading")){return false}i.toggleClass("tbk-loading");var n=i.closest(".tb-frontend-calendar").attr("data-params");var o=i.attr("data-increment");var s=i.attr("data-limit");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_upcoming_more",increment:o,params:n,limit:s},function(t){e.find(".tbk-slide.tbk-active").html(t.content);e.attr("data-params",t.parameters);a.getSlider().adaptHeight()},"json")}function l(e,a,i){i.toggleClass("tbk-loading");var n=i.attr("data-event");var o=i.attr("data-coworker");var s=i.attr("data-service");var r=i.closest(".tb-frontend-calendar").parent().attr("data-postid");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_get_register_modal",event:n,coworker:o,service:s,post_id:r},function(a){e.find(".tbk-dimmer").html(a).addClass("tbk-active");i.toggleClass("tbk-loading");t.tbkSliderGet(e).adaptHeight()})}function c(e,a,i){i.toggleClass("tbk-loading");var n=!!i.hasClass("tbk-allow");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_save_cookie_consent",allow:n},function(t){location.reload(true)})}function d(e,a,i){var n=i.attr("data-month");var o=e.attr("data-params");e.toggleClass("tbk-loading");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_fast_month_selector",month:n,params:o},function(t){e.find(".tbk-slide.tbk-active").html(t.content);e.attr("data-params",t.parameters);e.toggleClass("tbk-loading");a.getSlider().adaptHeight()},"json")}function u(e,a,i){var n=i.attr("data-year");var o=e.attr("data-params");e.toggleClass("tbk-loading");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_fast_year_selector",year:n,params:o},function(t){e.find(".tbk-slide.tbk-active").html(t.content);e.attr("data-params",t.parameters);e.toggleClass("tbk-loading");a.getSlider().adaptHeight()},"json")}t("table.tb-reservations-list a.tb-cancel-reservation").on("click",function(e){var a=t(this);e.preventDefault();var i=a.data("id");var n=a.data("hash");var o=a.data("modal");var s=t("#tbk-modal-"+o).remodal();s.open();t("#tbk-modal-"+o).data("id",i).data("hash",n)});t(document).on("confirmation",".tbk-reservation-cancel-modal",function(){if(t(this).hasClass("tbk-loading"))return false;t(this).addClass("tbk-loading");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_cancel_reservation",reservation_id:t(this).data("id"),reservation_hash:t(this).data("hash")},function(e){if(e.response=="ok"){location.reload(true)}else{t(this).removeClass("tbk-loading");console.log(e)}},"json")});function h(h){var k=this;var p=null;this.getSlider=function(){return p};this.init=function(){p=new f(h);p.init();h.on("click keydown",".tbk-calendar-month-selector",function(t){return k.makeAccessible(t,k.showMonths)}).on("click keydown",".tbk-calendar-year-selector",function(t){return k.makeAccessible(t,k.showYears)}).on("click keydown",".tbk-back-to",function(e){if(t(this).hasClass("tbk-show-cart-menu")){t(document).find(".tbk-cart").each(function(){if(!t(this).hasClass("tbk-cart-empty")){t(this).show()}})}if(t(this).hasClass("tbk-back-to-calendar")){return k.makeAccessible(e,k.backToCalendar)}else{return k.makeAccessible(e,k.backToPrevious)}}).on("click keydown",".ui.tb-day.slots",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){a(h,k,t(this));return false}}).on("click keydown",".tbk-cart-next-step",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){if(t(this).hasClass("tbk-loading")===false){k.bookNow(t(this))}return false}}).on("form:book",".tbk-reservation-form",function(t,e){k.bookNow(e)}).on("click keydown",".tbk-cart-cancel-process",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){if(t(this).hasClass("tbk-loading")===false){k.cancelCheckout(t(this))}return false}}).on("click keydown",".tbk-book-confirmation-button",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){if(t(this).hasClass("tbk-loading")===false){k.confirmBooking(t(this))}return false}}).on("click keydown",".tbk-refresh",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){t(this).addClass("tbk-loading");var a=t(document).triggerHandler("tbk:is:refreshing");if(typeof a==="undefined"){location.reload(true)}else{t(this).removeClass("tbk-loading")}return false}}).on("click keydown",".tb-change-month",function(a){a.stopPropagation();if(a.which==13||a.which==32||a.which==1){e(h,k,t(this));return false}}).on("click keydown",".tbk-slide .tb-book",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){s(h,k,t(this));return false}}).on("click keydown",".tbk-slide .tbk-add",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){o(h,k,t(this));return false}}).on("click keydown",".tbk-show-more",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){r(h,k,t(this));return false}}).on("click keydown",".tbk-schedule-slot.tb-book-advice, .tbk-upcoming-slot.tb-book-advice",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){l(h,k,t(this));return false}}).on("click keydown",".tbk-cookie",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){c(h,k,t(this));return false}}).on("click keydown",".tb-fast-selector-month-panel .tbk-month-selector",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){d(h,k,t(this));return false}}).on("click keydown",".tb-fast-selector-year-panel .tbk-year-selector",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){u(h,k,t(this));return false}}).on("click keydown",".tbk-edit-form",function(e){if(e.which==13||e.which==32||e.which==1){var a=t(this).data("service");var i=t(this).closest(".tb-frontend-calendar");i.addClass("tbk-loading");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_checkout_edit_form",service:a},function(t){p.replaceSlide(t.content);i.removeClass("tbk-loading")},"json")}}).on("click keydown",".tbk-edit-form-action.tbk-cancel",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){i(h,k,t(this));return false}}).on("click keydown",".tbk-schedule-filter-icon",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){var a=t(this).data("target");t(this).toggleClass("tbk-selected");h.find(".tbk-"+a+"-filter-panel").toggleClass("lifted");p.adaptHeight();return false}}).on("change input",".tbk-summary-table input",function(){var e=parseInt(t(this).val())||1;var a=parseInt(this.getAttribute("max"));if(e>a){t(this).val(a)}t(this).closest("tr").find(".tbk-summary-row-unit-price").trigger("amount:update");p.getCurrentSlide().find(".tbk-amount-button").trigger("amount:update");p.adaptHeight()}).on("click keydown",".tbk-dimmer-off",function(t){t.stopPropagation();if(t.which==13||t.which==32||t.which==1){h.find(".tbk-dimmer").removeClass("tbk-active").html("");p.adaptHeight()}}).on("click keydown",".tbk-pay-button",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){k.submitPayment(t(this))}}).on("click mousedown",".tbk-field textarea",function(t){h.css("height","auto")}).parent().on("click keydown",".tbk-cart .tbk-cart-booking",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){i(h,k,t(this));return false}}).on("click keydown",".tbk-cart-remove-item",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){n(h,k,t(this))}})};function b(e){e.find("input[type!='hidden']:not(.tbk-input-value-confirmation), textarea").each(function(){t(this).closest(".tbk-field").removeClass("tbk-error");e.on("input","input[type!='hidden'], textarea",function(){t(this).closest(".tbk-field").removeClass("tbk-error");t(this).siblings(".tbk-reservation-form-pointing-error").hide(0,function(){p.adaptHeight()})});e.on("change","input[type='file'], textarea",function(){t(this).closest(".tbk-field").removeClass("tbk-error");t(this).siblings(".tbk-reservation-form-pointing-error").hide(0,function(){p.adaptHeight()})});if(t(this).prop("required")&&!t(this).val()&&!t(this).hasClass("tbk-field-skip")){t(this).closest(".tbk-field").addClass("tbk-error")}if(typeof t(this).data("validation")!=="undefined"&&t(this).val().length>0){var a=new RegExp(tb_base64_decode(t(this).data("validation")));if(a.test(t(this).val())===false){t(this).siblings(".tbk-reservation-form-pointing-error").eq(0).show();t(this).closest(".tbk-field").addClass("tbk-error")}}if(!this.checkValidity()&&!t(this).hasClass("tbk-field-skip")){t(this).closest(".tbk-field").addClass("tbk-error")}});e.find("input[type!='hidden'].tbk-input-value-confirmation").each(function(){var e=t(this).attr("type");var a=t(this).closest(".tbk-field").find("input[type="+e+"]:not(.tbk-input-value-confirmation)");if(t(this).val()!==a.val()){t(this).siblings(".tbk-reservation-form-pointing-error.tbk-value-confirmation").show();t(this).closest(".tbk-field").addClass("tbk-error")}});p.adaptHeight();e.find(".tbk-dropdown").each(function(){t(this).closest(".tbk-field").removeClass("tbk-error");if(t(this).find("input").prop("required")&&!t(this).find("input").val()){t(this).closest(".tbk-field").addClass("tbk-error")}});e.find("input[type='checkbox']").each(function(){t(this).closest(".tbk-field").removeClass("tbk-error");if(t(this).prop("required")&&!t(this).prop("checked")){t(this).closest(".tbk-field").addClass("tbk-error");e.on("change keyup","input[type='checkbox']",function(){t(this).closest(".tbk-field").removeClass("tbk-error")})}});var a=true;e.find("input[type!='hidden'], input[type='checkbox'], .tbk-dropdown, textarea").each(function(){if(t(this).closest(".tbk-field").hasClass("tbk-error")){a=false}});e.closest(".tbk-reservation-form-container").find(".tbk-ticket-value").each(function(){t(this).closest("td").find(".tbk-tickets-span").removeClass("tbk-error");if(!t(this).val()){t(this).closest("td").find(".tbk-tickets-span").addClass("tbk-error");a=false}});return a}this.submitPayment=function(e){if(e.hasClass("tbk-loading")){return}e.addClass("tbk-loading");var a=e.data("gateway");var i=e.data("offsite");var n=e.closest(".tbk-pre-payment").data("checksum");var o=e.closest(".tbk-pre-payment").data("id");var s=e.closest(".tbk-pre-payment").data("order");var r=e.closest(".tbk-pre-payment").data("order-redirect");t.post(TB_Ajax.ajax_url,{action:"tb_submit_payment",reservation_checksum:n,gateway_id:a,reservation_database_id:o,order:s,order_redirect:r},function(a){if(i==true||a.status=="redirect"||a.status=="stripe"){if(a.status=="stripe"){var n=Stripe(TB_Stripe.pub_key);n.redirectToCheckout({sessionId:a.stripe_session_id}).then(function(t){console.log(t);e.removeClass("tbk-loading")})}else{window.location.href=a.redirect}}else{var o=t(t.parseHTML(a.content,document,true));p.goToSlide(p.addSlide(o).index()).adaptHeight();e.removeClass("tbk-loading")}},"json")};this.cancelCheckout=function(e){e.addClass("tbk-loading");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_checkout_cancel"},function(e){k.backToCalendar();t(".tbk-cart").show()})};this.bookNow=function(e){if(e.hasClass("tbk-cart-next-step")){var a="tbajax_action_checkout"}else{a="tbajax_action_prepare_form"}var i=e.closest(".calendar_main_container, .calendar_widget_container");var n=e.data("files");var o=e.closest(".tbk-reservation-form-container").find(".tbk-reservation-form");var s=o.find("input[name='service']").val();var r=i.attr("data-postid");o.find("input[name='post_id']").val(r);var l=i.find(".tbk-timezones .tbk-menu .tbk-menu-item.tbk-selected").data("timezone")||false;var c=e.closest(".tbk-slide").find(".tbk-summary-coupon-input").val();if(b(o)){e.addClass("tbk-loading");if(n){var d=[];o.find(".tbk-already-uploaded-message").each(function(){d.push(t(this).attr("data-already-uploaded"))});var u=new FormData;u.append("data",o.serialize());u.append("timezone",l);u.append("coupon",c);u.append("service_id",s);u.append("action",a);u.append("already_uploaded_ok",d);o.find('input[type="file"]').not(".tbk-field-skip").each(function(){var e=t(this).attr("name");u.append(e,this.files[0])});t.ajax({url:TB_Ajax.ajax_url,type:"POST",data:u,processData:false,contentType:false,success:function(t){if(e.hasClass("tbk-cart-next-step")){t=t.content;if(e.hasClass("tbk-edit-form-action")){p.replaceSlide(t)}else{p.goToSlide(p.addSlide(t).index()).adaptHeight()}k.scrollToTop(e);e.removeClass("tbk-loading")}else{if(t.status=="redirect"){window.location.href=t.redirect}else{p.goToSlide(p.addSlide(t.content).index()).adaptHeight();e.removeClass("tbk-loading");k.scrollToTop(e)}}}})}else{t.post(TB_Ajax.ajax_url,{action:a,data:o.serialize(),timezone:l,coupon:c,service_id:s},function(t){if(e.hasClass("tbk-cart-next-step")){t=t.content;p.goToSlide(p.addSlide(t).index()).adaptHeight();k.scrollToTop(e);e.removeClass("tbk-loading")}else{if(t.status=="redirect"){window.location.href=t.redirect}else{p.goToSlide(p.addSlide(t.content).index()).adaptHeight();e.removeClass("tbk-loading");k.scrollToTop(e)}}},"json")}}};this.scrollToTop=function(e){var a=e.closest(".calendar_main_container, .calendar_widget_container");t("html, body").animate({scrollTop:a.offset().top-50},200)};this.confirmBooking=function(e){e.addClass("tbk-loading");var a=e.closest(".tbk-reservation-review-container").data("reservation");t.post(TB_Ajax.ajax_url,{action:"tbajax_action_submit_form",reservation:a},function(t){if(t.status=="redirect"){window.location.href=t.redirect}else{p.goToSlide(p.addSlide(t.content).index()).adaptHeight();e.removeClass("tbk-loading");k.scrollToTop(e)}},"json")};this.makeAccessible=function(t,e,a){t.stopPropagation();if(t.which==13||t.which==32||t.which==1){e(a);return false}};this.showMonths=function(){h.find(".tb-fast-selector-year-panel").addClass("lifted");h.find(".tb-fast-selector-month-panel").toggleClass("lifted");h.find(".tbk-calendar-month-selector").toggleClass("active");h.find(".tbk-calendar-year-selector").removeClass("active");p.adaptHeight()};this.showYears=function(){h.find(".tb-fast-selector-month-panel").addClass("lifted");h.find(".tb-fast-selector-year-panel").toggleClass("lifted");h.find(".tbk-calendar-year-selector").toggleClass("active");h.find(".tbk-calendar-month-selector").removeClass("active");p.adaptHeight()};this.showSlots=function(e){var a=p.addSlide(e);a.find(".tbk-schedule-filters").on("click keydown",".tbk-schedule-filter-item",function(e){e.stopPropagation();if(e.which==13||e.which==32||e.which==1){t(this).parent().find(".tbk-schedule-filter-item").removeClass("tbk-selected");t(this).addClass("tbk-selected");var i=jQuery(this).closest(".tbk-schedule-slots");var n="";var o={timeint:a.find(".tbk-schedule-time-select").find(".tbk-selected").data("value"),address:a.find(".tbk-schedule-location-select").find(".tbk-selected").data("value"),coworker:a.find(".tbk-schedule-coworker-select").find(".tbk-selected").data("value")};for(var s in o){if(typeof o[s]==="undefined")continue;if(o.hasOwnProperty(s)&&o[s]!=="all"&&o[s].length!==0&&s!=="timeint"){n+="[data-"+s+'="'+o[s]+'"]'}}i.find(".tbk-schedule-slot").hide();if(o.timeint!=="all"){i.find(".tbk-schedule-slot"+n).filter(function(){return jQuery(this).attr("data-timeint")>=o.timeint}).show()}else{i.find(".tbk-schedule-slot"+n).show()}p.adaptHeight()}});p.goToSlide(a.index())};this.backToCalendar=function(){p.cleanSlides().goToSlide(0)};this.backToPrevious=function(){var t=p.getCurrentSlide().index();p.getCurrentSlide().remove();p.goToSlide(t-1)};this.get=function(){return h}}function f(e){var a=this;var i={active:"tbk-active",inactive:"tbk-inactive",canvas:"tbk-slide-canvas",slide:"tbk-slide"};var n=e.find("."+i.canvas);this.slides=n.find("."+i.slide);this.init=function(){this.slides.addClass(i.inactive);t(this.slides.get(0)).removeClass(i.inactive).addClass(i.active);e.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(t){a.refreshResponsiveness();e.trigger("tbk:slider:adapt")});t(window).resize(function(){a.refreshResponsiveness();e.trigger("tbk:slider:adapt")});n.contents().each(function(){if(this.nodeType===3&&!t.trim(this.nodeValue)){t(this).remove()}});e.on("tbk:slider:adapt",function(){a.adaptHeight()});a.refreshResponsiveness();e.trigger("tbk:slider:adapt")};this.countSlides=function(){this.slides=e.find("."+i.canvas).find("."+i.slide);return this.slides.length};this.refreshResponsiveness=function(){e.removeClass("tbk-big-container tbk-mid-container tbk-small-container");if(e.width()>499){e.addClass("tbk-big-container")}else if(e.width()>299){e.addClass("tbk-mid-container")}else{e.addClass("tbk-small-container")}};this.adaptHeight=function(){if(e.find(".tbk-dimmer").hasClass("tbk-active")){e.height(e.find(".tbk-dimmer").height())}else{e.height(n.find("."+i.slide+"."+i.active).actual("height"))}};this.goToSlide=function(e){n.attr("class",i.canvas+" "+i.slide+"-"+e);n.find("."+i.slide).addClass(i.inactive).removeClass(i.active);t(this.slides.get(e)).removeClass(i.inactive).addClass(i.active);this.adaptHeight();return this};this.addSlide=function(e){var a=t("<div>");a.addClass(i.slide+" "+i.inactive).html(e).appendTo(n);this.countSlides();return a};this.replaceSlide=function(t){var e=this.getCurrentSlide();e.html(t);this.adaptHeight();return e};this.addToSlide=function(e,a){var i=t(this.slides.get(a));i.html(e);this.adaptHeight();return i};this.getCurrentSlide=function(){return n.find("."+i.slide+"."+i.active)};this.cleanSlides=function(){this.slides.slice(1).remove();this.countSlides();return this}}t.tbkSliderGet=function(t){return new f(t)};t(document).click(function(){var e=t(".tbk-menu");if(e.parent().hasClass("tbk-setting-button")){e.parent().removeClass("tbk-selected")}e.hide()});tbkLoadInstance=function(e){var a=new h(e.find(".tb-frontend-calendar"));a.init();var i=a.getSlider();a.get().parent().on("click keydown",".tbk-main-calendar-settings .tbk-setting-button",function(e){e.stopPropagation();if(e.which!=13&&e.which!=1){return}t(this).siblings().removeClass("tbk-selected").find(".tbk-menu").hide();t(this).toggleClass("tbk-selected").find(".tbk-menu").toggle()});a.get().parent().on("click",".tbk-main-calendar-settings .tbk-setting-button:not(.tbk-cart) .tbk-menu-item",function(){t(this).closest(".tbk-setting-button").find(".tbk-text").html(t(this).html())});a.get().parent().on("click keydown",".tbk-main-calendar-settings .tbk-setting-button:not(.tbk-cart) .tbk-menu-search",function(t){t.stopPropagation()});a.get().parent().on("keyup",".tbk-main-calendar-settings .tbk-setting-button:not(.tbk-cart) .tbk-menu-search input",function(e){e.stopPropagation();var a=t(this).val().toUpperCase().replace(/[/ ]/g,"");t(this).closest(".tbk-menu").find(".tbk-menu-item").each(function(){t(this).show();if(a.length>1){if(t(this).html().toUpperCase().replace(/[/ ]/g,"").indexOf(a)>=0){t(this).show()}else{t(this).hide()}}})});e.on("click keydown",".tbk-main-calendar-settings .tbk-setting-button:not(.tbk-cart) .tbk-menu-item",function(a){if(a.which!=13&&a.which!=1){return}var n=false;var o="tbajax_action_filter_calendar";if(e.hasClass("tbk-upcoming")){n=true;o="tbajax_action_filter_upcoming"}t(this).addClass("tbk-selected").siblings().removeClass("tbk-selected");var s=t(this).closest(".calendar_main_container, .calendar_widget_container").find(".tb-frontend-calendar");var r={service:false,services:false,coworker:false,coworkers:false,timezone:false,params:s.attr("data-params")};t(this).closest(".tbk-filters").find(".tbk-menu-item.tbk-selected").each(function(){if(t(this).hasClass("tbk-reset-filter")){if(typeof t(this).attr("data-services")!=="undefined"){r.services=t(this).attr("data-services")}if(typeof t(this).attr("data-coworkers")!=="undefined"){r.coworkers=t(this).attr("data-coworkers")}}else{if(typeof t(this).attr("data-service")!=="undefined"){r.service=t(this).attr("data-service")}if(typeof t(this).attr("data-coworker")!=="undefined"){r.coworker=t(this).attr("data-coworker")}}});if(typeof t(this).attr("data-timezone")!=="undefined"){r.timezone=t(this).attr("data-timezone")}s.addClass("tbk-loading");t.post(TB_Ajax.ajax_url,{action:o,service:r.service,services:r.services,coworker:r.coworker,coworkers:r.coworkers,timezone:r.timezone,params:r.params},function(e){var a=s.parent();a.find(".tbk-cart").show();if(n){a.find(".tbk-slide.tbk-active").html(e.upcoming);s.removeClass("tbk-loading");s.attr("data-params",e.parameters);i.adaptHeight();return}if(e.cart_slots){t.each(e.cart_slots,function(e,i){a.find(".tbk-cart").each(function(){t(this).find('.tbk-menu button[data-item="'+e+'"]').closest(".tbk-menu-item").replaceWith(i.menu_item)})})}a.find(".tbk-cart.tbk-cart-empty").hide();if(e.unscheduled==false){a.find(".tbk-main-calendar-settings").find(".tbk-coworkers, .tbk-timezones").show();a.find(".tbk-slide.tbk-active").html(e.calendar)}else{a.find(".tbk-main-calendar-settings").find(".tbk-coworkers, .tbk-timezones").hide();a.find(".tbk-slide.tbk-active").html(e.calendar)}s.removeClass("tbk-loading");s.attr("data-params",e.parameters);i.adaptHeight()},"json")})};t(".calendar_main_container, .calendar_widget_container").each(function(){tbkLoadInstance(t(this))})});(function(t){t.fn.tbkAmountButton=function(e){var a=t.extend({buttonText:"Confirm",buttonClass:"tbk-amount-button",toPayNowText:"To pay now",confirmAndPayText:"Confirm and pay",currencySymbol:"$",currencyFormat:"before",defaultAmountTotal:0,defaultAmountTotalDisc:0,defaultAmountToPayNow:0,defaultAmountToPayNowDisc:0,decimals:2,amountTotalClass:".tbk-amount",amountTotalDiscClass:".tbk-amount-disc",amountToPayNowClass:".tbk-amount-to-be-paid",amountToPayNowDiscClass:".tbk-amount-to-be-paid-disc",toPayNowClass:".tbk-to-pay-now",isCheckout:false},e);var i=this;var n=false;var o=this.closest(".tbk-slide");var s;this.on("coupon:applied",function(t,e){if(a.isCheckout){}else{s=a.defaultAmountTotalDisc;a.defaultAmountTotalDisc=e;i.trigger("amount:update")}n=true});this.on("coupon:removed",function(){if(a.isCheckout){}else{a.defaultAmountTotalDisc=s;i.trigger("amount:update")}n=false});this.changeButtonText=function(t){var e=i.children();i.html(t+" ").append(e)};this.on("click keydown",function(t){t.stopPropagation();if(t.which==13||t.which==32||t.which==1){if(i.hasClass("tbk-loading"))return false;if(a.isCheckout){i.trigger("tbk:confirm:checkout")}else{o.find(".tbk-reservation-form").trigger("form:book",[i])}return false}});this.on("tbk:confirm:checkout",function(){var e=[];o.find("tr").each(function(){if(typeof t(this).attr("data-reservation")!=="undefined"){e.push(t(this).attr("data-reservation"))}});if(e.length===0){return false}i.addClass("tbk-loading");var a=o.find("input").serialize();var n=o.find(".tbk-summary-coupon-input").val();t.post(TB_Ajax.ajax_url,{action:"tbajax_action_checkout_confirm",inputs:a,tbk_coupon:n,reservations:e},function(e){if(e.redirect==="yes"){window.location.href=e.redirect_url}else{console.log(e.results);var a=t.tbkSliderGet(o.closest(".tb-frontend-calendar"));var n=e.content;a.goToSlide(a.addSlide(n).index()).adaptHeight();t(".tbk-cart").remove();i.removeClass("tbk-loading")}},"json")});this.on("amount:update",function(){var e=0;var n=0;var s=0;var r=0;if(a.isCheckout){o.find(".tbk-summary-row-unit-price").each(function(){var a=t(this).closest("tr");var i=t(this).data("raw-unit-price");if(a.find('input[type="number"]').length>0){var o=parseInt(a.find('input[type="number"]').val())||1;i=i*o}if(a.find(".tbk-summary-row-payment").find(".tbk-summary-pay-immediately").length>0||a.find(".tbk-summary-row-payment").find("input:checkbox:checked").length>0){n=n+i;r=n}e=e+i;s=e})}else{var l=o.find("form");var c=parseInt(o.find(".tbk-ticket-value").val())||1;var d=0;l.find("input[type=radio]:checked, .tbk-dropdown .tbk-item.active.selected").each(function(){var e=parseFloat(t(this).data("price-inc"));if(isNaN(e))e=0;d=d+e});e=(a.defaultAmountTotal+d)*c;n=e;s=(a.defaultAmountTotalDisc+d)*c;r=s}var u="";var h="";if(a.currencyFormat==="before"){u=a.currencySymbol}else{h=a.currencySymbol}if(e===s){i.find(a.amountToPayNowClass).html(u+n.toFixed(a.decimals).toString()+h);i.find(a.amountTotalClass).html(u+e.toFixed(a.decimals).toString()+h)}else{i.find(a.amountToPayNowClass).html(u+"<del>"+n.toFixed(a.decimals).toString()+"</del>"+'<span class="'+a.amountToPayNowDiscClass.split(".").join("")+'">'+r.toFixed(a.decimals).toString()+"</span>"+h);i.find(a.amountTotalClass).html(u+"<del>"+e.toFixed(a.decimals).toString()+"</del>"+'<span class="'+a.amountTotalDiscClass.split(".").join("")+'">'+s.toFixed(a.decimals).toString()+"</span>"+h)}if(e===0){i.find(a.amountTotalClass).hide();i.find(a.toPayNowClass).hide();i.changeButtonText(a.buttonText)}else if(e===n){i.find(a.amountTotalClass).show();i.find(a.toPayNowClass).hide();if(a.isCheckout){i.changeButtonText(a.confirmAndPayText)}}else if(n>0){i.find(a.amountTotalClass).show();i.find(a.toPayNowClass).show();i.changeButtonText(a.buttonText)}else{i.find(a.amountTotalClass).show();i.find(a.toPayNowClass).hide();i.changeButtonText(a.buttonText)}});this.addClass(a.buttonClass).trigger("amount:update")};t.fn.tbkSummaryRowPrice=function(e){var a=t.extend({currencySymbol:"$",currencyFormat:"before",decimals:2,unitPrice:0,incrementedPrice:0,toHideSelector:".tbk-payment-info"},e);var i=this;var n=a.unitPrice;var o=this.closest("tr");var s=a.incrementedPrice-a.unitPrice;var r="";var l="";if(a.currencyFormat==="before"){r=a.currencySymbol}else{l=a.currencySymbol}this.on("coupon:applied",function(t,e){n=e;i.trigger("amount:update")});this.on("coupon:removed",function(){n=a.unitPrice;i.trigger("amount:update")});this.on("amount:update",function(){if(o.find('input[type="number"]').length>0){var t=parseInt(o.find('input[type="number"]').val())||1;var e=Math.min(a.unitPrice+s,n+s)*t}else{e=Math.min(a.unitPrice,n)+s}i.html(r+e.toFixed(a.decimals).toString()+l);i.data("raw-unit-price",Math.min(a.unitPrice,n)+s);if(e<=0){o.find(a.toHideSelector).hide()}else{o.find(a.toHideSelector).show()}})};t.fn.tbkCouponInput=function(e){var a=t.extend({appliedClass:".tbk-summary-coupon-applied",inputClass:".tbk-summary-coupon-input",applyButtonClass:".tbk-summary-apply-coupon",removeButtonClass:".tbk-summary-remove-coupon",applyButtonText:"Apply",removeButtonText:"Remove",wrongCouponText:"Wrong or expired code!",isCheckout:false},e);var i=this;var n=this.closest(".tbk-slide");var o=this.find(a.inputClass);var s=o.attr("placeholder");o.on("change keydown click",function(){t(this).attr("placeholder",s)});this.find(a.applyButtonClass).html(a.applyButtonText);this.on("click keydown",a.applyButtonClass,function(){var e=o.val();if(e.length<1){return false}var s=t(this);s.addClass("tbk-loading");o.prop("disabled",true);var r=n.find('input[name="slot"]').val();var l=n.find('input[name="service"]').val();var c;if(a.isCheckout){c="tbajax_action_validate_coupon_cart"}else{c="tbajax_action_validate_coupon"}t.post(TB_Ajax.ajax_url,{action:c,code:e,slot:r,service_id:l},function(r){if(r.status==="error"){o.val("").prop("disabled",false);o.attr("placeholder",a.wrongCouponText)}else{o.hide();i.find(a.appliedClass).css("display","inline-block").find("span").html(e);if(a.isCheckout){t.each(r.value,function(t,e){n.find("tr[data-slot-id='"+t+"']").find(".tbk-summary-row-unit-price").trigger("coupon:applied",[e.discounted])});n.find(".tbk-amount-button").trigger("amount:update")}else{n.find(".tbk-amount-button").trigger("coupon:applied",[r.value]);n.find(".tbk-tickets-price-section").trigger("coupon:applied",[r.value])}s.removeClass("tbk-loading "+a.applyButtonClass.split(".").join("")).addClass(a.removeButtonClass.split(".").join("")).html(a.removeButtonText)}s.removeClass("tbk-loading")},"json")});this.on("click keydown",a.removeButtonClass,function(){o.val("").prop("disabled",false);var e=t(this);o.show();i.find(a.appliedClass).hide().find("span").html("");if(a.isCheckout){n.find(".tbk-summary-row-unit-price").trigger("coupon:removed");n.find(".tbk-amount-button").trigger("amount:update")}else{n.find(".tbk-amount-button").trigger("coupon:removed");n.find(".tbk-tickets-price-section").trigger("coupon:removed")}e.removeClass(a.removeButtonClass.split(".").join("")).addClass(a.applyButtonClass.split(".").join("")).html(a.applyButtonText)});return this};t.fn.tbkMaps=function(e){var a=t.extend({mapstyle:"",zoom_level:"",address:""},e);return this.each(function(){var e=t(this);var i=t(this).closest(".tbk-slide");if(typeof google!=="undefined"){var n=false;e.gmap3({getlatlng:{address:a.address,callback:function(t){if(!t){var i=new google.maps.Map(e[0]);var o=new google.maps.places.PlacesService(i);var s={query:a.address};o.textSearch(s,function(t,i){if(i==google.maps.places.PlacesServiceStatus.OK){n=t[0].geometry.location;a.address=t[0].formatted_address;e.gmap3({clear:{id:"tbk-map-directions"},map:{options:{zoom:a.zoom_level,center:n}},marker:{address:a.address,id:"tbk-map-init-address"}})}else{e.gmap3("destroy");e.html("<div class='tbk-map-address-failed'>The address or place can't be geocoded by Google.</div>")}})}else{n=t[0].geometry.location}}},marker:{address:a.address,id:"tbk-map-init-address"},map:{options:{zoom:a.zoom_level,scrollwheel:false,mapTypeId:"style",mapTypeControl:false,navigationControl:true}},styledmaptype:{id:"style",options:{name:"Map"},styles:a.mapstyle}});i.find('input[id^="tbk-address"]').on("input",function(){e.gmap3({clear:{id:"tbk-map-directions"},map:{options:{zoom:a.zoom_level,center:n}}})}).on("geocode:result",function(t,i){e.gmap3({getroute:{options:{origin:i.geometry.location,destination:a.address,travelMode:google.maps.DirectionsTravelMode.DRIVING},callback:function(t){if(!t)return;e.gmap3({clear:{id:"tbk-map-directions"},directionsrenderer:{options:{directions:t},id:"tbk-map-directions"}})}}})})}else{e.html("<div class='tbk-map-missing-library'>Google Maps library not loaded.</div>")}})};t.fn.tbkTicketLine=function(e){var a=t.extend({unitPriceClass:".tbk-total-price-line-price-unit",defaultAmountUnit:0,defaultAmountUnitDisc:0,currencyFormat:"before",currencySymbol:"$",decimals:2,amountUnitDiscClass:".tbk-discounted-price",inputNumberClass:".tbk-ticket-value"},e);return this.each(function(){var e=t(this);var i=e.closest(".tbk-slide");var n=false;var o;e.on("coupon:applied",function(t,i){o=a.defaultAmountUnitDisc;a.defaultAmountUnitDisc=i;e.trigger("tickets:unitprice:update");n=true});e.on("coupon:removed",function(){a.defaultAmountUnitDisc=o;e.trigger("tickets:unitprice:update");n=false});e.on("keyup",a.inputNumberClass,function(){var e=parseInt(t(this).val())||1;var a=parseInt(this.getAttribute("max"));if(e>a){t(this).val(a)}t(this).trigger("change")});e.on("click change",a.inputNumberClass,function(){i.find(".tbk-amount-button").trigger("amount:update");var e=parseInt(t(this).val())||1;t(this).closest(".tbk-reservation-form-container").find("form input[name=tickets]").val(e)});e.on("tickets:unitprice:update",function(){var n=i.find("form");var o=0;n.find("input[type=radio]:checked, .tbk-dropdown .tbk-item.active.selected").each(function(){var e=parseFloat(t(this).data("price-inc"));if(isNaN(e))e=0;o=o+e});var s=a.defaultAmountUnit+o;var r=a.defaultAmountUnitDisc+o;var l="";var c="";if(a.currencyFormat==="before"){l=a.currencySymbol}else{c=a.currencySymbol}if(s===r){e.find(a.unitPriceClass).html(l+s.toFixed(a.decimals).toString()+c)}else{e.find(a.unitPriceClass).html(l+"<del>"+s.toFixed(a.decimals).toString()+"</del>"+'<span class="'+a.amountUnitDiscClass.split(".").join("")+'">'+r.toFixed(a.decimals).toString()+"</span>"+c)}});e.trigger("tickets:unitprice:update")})}})(jQuery);